---
import { Image } from 'astro:assets';
import type { Review } from '../../models/Review';

const {
  movie,
  rank,
  lazyLoad = false
} = Astro.props;


const cardText = () => {
  if (!movie.isReleased) {
    return movie.releaseDateText;
  }

  if (movie.getPriorityReview().overallRating > 0) {
    return `${movie.getPriorityReview().overallRating}/10`;
  }

  return;
};
---

<a
  href={`/movie/${movie.slug}`}
  class="relative group"
  id={movie.name}
>
  <Image
    src={movie.posterUrl}
    alt={movie.name}
    width={300}
    height={450}
    class="w-full rounded-lg bg-gray-200 object-cover group-hover:opacity-75"
    loading={lazyLoad ? "lazy" : "eager"}
  />
  {
    rank ? (
      <span class="absolute top-0 left-0 bg-red-500 text-white text-sm font-bold flex items-center justify-center w-6 h-6 lg:w-12 lg:h-12 clip-triangle">
        {rank}
      </span>
    ) : <></>
  }
  <div class="absolute top-0 right-0 flex flex-row items-start space-x-1 p-1 bg-black bg-opacity-50 rounded-bl-lg">
    {
      movie.getTopCategories()
        .map((categoryName: string) => (
          <img
            class="w-5 h-5"
            src={`/icons/categories/${categoryName}.svg`}
            alt={`${categoryName} icon`}
          />
        ))
    }
  </div>
  <div
    class="absolute bottom-0 left-0 w-full bg-black bg-opacity-60 text-white text-center sm:text-sm lg:text-lg font-semibold py-1  items-center justify-center flex gap-2 rounded-tr-lg"
  >
  {
    movie.reviews
      .map((review: Review) => (
      <span class="inline-flex items-center justify-center gap-1 text-white">
          <img
            class="w-5 h-5"
            src={`/icons/${review.type}.svg`}
            alt={`${review.type} review icon`}
          />
        {review.overallRating}/10
      </span>
      ))
  }
  </div>
</a>
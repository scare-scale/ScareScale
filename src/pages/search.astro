---
import MainLayout from "../layouts/MainLayout.astro";
import MoviesGrid, { Sort } from "../components/grids/MoviesGrid.astro";
import { movies } from "../lib/movies";

export const prerender = false;

const url = new URL(Astro.request.url);
const params = url.searchParams;
const q = params.get("q")?.toLowerCase() || "";

if (q.length < 3) {
  return Astro.redirect("/");
}

// Filter movies
const filteredMovies = movies.getAll().filter((movie) => {
  const title = movie.name.toLowerCase();
  const matchesSearch = !q || title.includes(q);
  return matchesSearch;
});
---
<MainLayout>
  <section class="pt-10 pb-20">
    <header class="text-center px-6 lg:px-8 max-w-4xl mx-auto mb-16">
      <div class="inline-flex items-center gap-3 bg-red-600/20 border border-red-500/30 rounded-full px-6 py-2 mb-6">
        <img src="/icons/search.svg" alt="Search" class="w-5 h-5 text-red-400" />
        <span class="text-red-400 font-medium">Search Results</span>
      </div>
      <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-white mb-4 leading-tight">
        Found <span class="text-red-400">{filteredMovies.length}</span> results
      </h1>
      <p class="text-xl text-gray-300 mb-2">
        for "{q}"
      </p>
      <div class="w-24 h-1 bg-gradient-to-r from-red-600 to-red-400 mx-auto rounded-full"></div>
    </header>

    <div class="flex flex-col gap-y-8">
        <section class="mx-auto max-w-2xl px-6 lg:max-w-7xl lg:px-8" id="searchResults">
          <MoviesGrid
          lazyLoad={true}
          hidden={false}
          sort={Sort.HighestToLowestScore}
          showAll={true}
          movies={filteredMovies}
        />
        {filteredMovies.length === 0 && (
          <div class="text-center py-16">
            <div class="bg-gray-800/50 backdrop-blur-sm rounded-lg p-8 max-w-md mx-auto border border-gray-700">
              <img src="/icons/search.svg" alt="No results" class="w-16 h-16 text-gray-500 mx-auto mb-4 opacity-50" />
              <p class="text-xl text-gray-400 mb-2">No movies found</p>
              <p class="text-sm text-gray-500">Try a different search term</p>
            </div>
          </div>
        )}
        </section>
    </div>
  </section>
</MainLayout>
---
import MainLayout from "../layouts/MainLayout.astro";
import MoviesGrid, { Sort } from "../components/grids/MoviesGrid.astro";
import { allMovies } from "../content.config";

export const prerender = false;

const url = new URL(Astro.request.url);
const params = url.searchParams;
const q = params.get("q")?.toLowerCase() || "";

if (q.length < 3) {
  return Astro.redirect("/");
}

// Filter movies
const filteredMovies = allMovies.filter((movie) => {
  const title = movie.data.name.toLowerCase();
  const matchesSearch = !q || title.includes(q);
  return matchesSearch;
});
---
<MainLayout>
  <section class="pt-10 pb-20">
    <header class="text-center px-6 lg:px-8 max-w-3xl mx-auto mb-16">
      <h1 class="text-4xl sm:text-5xl font-bold text-white mb-4">
        Search Results
      </h1>
      <p class="text-lg text-gray-300">
        {filteredMovies.length} results for {q}
      </p>
    </header>

    <div class="flex flex-col gap-y-8">
        <section class="mx-auto max-w-2xl px-6 lg:max-w-7xl lg:px-8">
          <MoviesGrid
          lazyLoad={true}
          hidden={false}
          sort={Sort.HighestToLowestScore}
          showAll={true}
          movies={filteredMovies}
        />
        {filteredMovies.length === 0 && (
          <p class="text-center text-xl text-white">
            No Results
          </p>
        )}
        </section>
    </div>
  </section>
</MainLayout>